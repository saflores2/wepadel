<div class="container">
  <%if @tournament.type == "Champions League" %>
    <% rounds_array = (1..6).to_a %>
    <div class="d-flex justify-content-center">
      <p class="match_card_g1 border text-center">Grupo 1</p>
      <p class="match_card_g2 border text-center">Grupo 2</p>
      <p class="match_card_g3 border text-center">Grupo 3</p>
      <p class="match_card_g4 border text-center">Grupo 4</p>
    </div>
  <% elsif @tournament.type == "Express" %>
    <% rounds_array = (1..5).to_a %>
    <div class="d-flex justify-content-center">
      <p class="match_card_g2 border text-center">Grupo 1</p>
      <p class="match_card_g1 border text-center">Grupo 2</p>
      <p class="match_card_g3 border text-center">Competencia Primer Lugar</p>
      <p class="match_card border text-center">Competencia Quinto Lugar</p>
    </div>
  <% end %>




  <div class="d-flex p-2 m-2 justify-content-center">

    <% rounds_array.each do |round_number| %>
      <div>
        <% matches_array = @matches.where(round: round_number) %>
        <h5 class="text-center"><%= "Ronda #{round_number}" %></h5>

        <% matches_array.each do |m|%>
          <% if m.tournament.type == "Champions League" && m.match_number.in?([1, 2, 9, 10, 17, 18]) || m.tournament.type == "Express" && m.match_number.in?([3, 4, 7, 8, 11, 12])%>
            <div class="p-3 m-2 border text-center w-16 match_card_g1">
          <% elsif m.tournament.type == "Champions League" && m.match_number.in?([3, 4, 11, 12, 19, 20]) || m.tournament.type == "Express" && m.match_number.in?([1, 2, 5, 6, 9, 10])%>
            <div class="p-3 m-2 border text-center w-16 match_card_g2">
          <% elsif m.tournament.type == "Champions League" && m.match_number.in?([5, 6, 13, 14, 21, 22]) || m.tournament.type == "Express" && m.match_number.in?([13, 14, 17])%>
            <div class="p-3 m-2 border text-center w-16 match_card_g3">
          <% elsif m.tournament.type == "Champions League" && m.match_number.in?([7, 8, 15, 16, 23, 24])%>
            <div class="p-3 m-2 border text-center w-16 match_card_g4">
          <% else %>
            <div class="p-3 m-2 border text-center w-16 match_card">
          <% end %>

              <h6><%= "Partido #{m.match_number}" %></h6>

              <%# Si partido no ha finalizado y jugadores están definidos %>
              <% if m.first_team_id != nil && m.second_team_id != nil && m.winner_id.nil? %>
                <% team1 = Participation.find(m.first_team_id) %>
                <% team2 = Participation.find(m.second_team_id) %>
                <% user_team1 = User.find(team1.user_id) %>
                <% user_team2 = User.find(team2.user_id) %>
                <%= form_with url: match_games_path(m.id), method: :post do |f| %>
                  <p><%= "#{user_team1.email}" %></p>
                  <p class="d-flex justify-content-center"><%= f.number_field :games_first_team, class:"text-center", style: "width: 50px" %></p>
                  <p>VS</p>
                  <p><%= "#{user_team2.email}" %></p>
                  <p class="d-flex justify-content-center"><%= f.number_field :games_second_team, class:"text-center", style: "width: 50px" %></p>
                  <%= f.submit "Ingresar puntaje de set", class: "btn btn-primary", style: "background-color: #C6E3CC; color: black;" %>
                <% end %>
                <%# Mostrar sets anteriores %>
                <% sets = Game.where(match_id: m.id) %>
                <div class="d-flex justify-content-center">
                  <% sets.each do |s| %>
                      <div class="border p-2 m-1">
                      <p><%= s.games_first_team %></p>
                      <p><%= s.games_second_team %></p>
                      </div>
                  <% end %>
                </div>
                <%# Finalizar partido %>
                <%= form_with url: match_path(m.id), method: :patch do |f| %>
                  <div class="m-1"><%= f.submit "Finalizar partido", style:"background-color: #C6E3CC; color: black;" %></div>
                <% end  %>

              <%# Si partido finalizó %>
              <% elsif m.first_team_id != nil && m.second_team_id != nil && m.winner_id != nil %>
                <% team1 = Participation.find(m.first_team_id) %>
                <% team2 = Participation.find(m.second_team_id) %>
                <% user_team1 = User.find(team1.user_id) %>
                <% user_team2 = User.find(team2.user_id) %>
                <% if m.winner_id == m.first_team_id %>
                  <p class= "border text-center" style= "background-color: #C6E3CC; color: black;"><%= "#{user_team1.email}" %></p>
                  <p>VS</p>
                  <p><%= "#{user_team2.email}" %></p>
                <% else  %>
                  <p><%= "#{user_team1.email}" %></p>
                  <p>vs</p>
                  <p class= "border text-center" style= "background-color: #C6E3CC; color: black;"><%= "#{user_team2.email}" %></p>
                <% end %>
                <% sets = Game.where(match_id: m.id) %>
                <div class="d-flex justify-content-center">
                  <% sets.each do |s| %>
                      <div class="border p-2 m-1">
                      <p><%= s.games_first_team %></p>
                      <p><%= s.games_second_team %></p>
                      </div>
                  <% end %>
                </div>

              <%# Si no se han definido jugadores %>
              <% else %>
                <p><%= "#{m.first_team_name}" %></p>
                <p>VS</p>
                <p><%= "#{m.second_team_name}" %></p>
              <% end %>

            </div>
        <% end %>
      </div>
    <% end %>

  </div>



</div>
